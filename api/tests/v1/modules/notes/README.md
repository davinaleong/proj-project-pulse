# Notes Module Tests

This directory contains comprehensive test suites for the Notes module, organized into focused test files for better maintainability and clarity.

## Test Structure

### Core Files

- **`notes.helpers.ts`** - Shared test utilities, database setup/cleanup, and helper functions
- **`index.ts`** - Module exports for easy importing

### Test Suites

#### 1. `notes.crud.test.ts`

Tests for basic CRUD (Create, Read, Update, Delete) operations:

- Note creation with various data combinations
- Single note retrieval and validation
- Note updates (title, description, body, status)
- Note deletion and soft delete behavior
- Validation of required fields and data types

#### 2. `notes.search.test.ts`

Tests for search and filtering functionality:

- Text search across title, description, and body
- Status-based filtering (DRAFT, PUBLISHED, ARCHIVED)
- Project-based filtering
- Pagination and limit controls
- Sorting by different fields (title, createdAt, updatedAt)
- Advanced query combinations

#### 3. `notes.management.test.ts`

Tests for note lifecycle and management operations:

- Note restoration from soft delete
- Bulk operations and batch processing
- Note status transitions and workflows
- Project association and management
- Data consistency validation

#### 4. `notes.security.test.ts`

Tests for security, authentication, and input validation:

- Authentication requirements for all endpoints
- Authorization checks (users can only access their own notes)
- Input validation and sanitization
- SQL injection prevention
- XSS protection
- Rate limiting behavior
- Error handling for malformed requests

#### 5. `notes.edge-cases.test.ts`

Tests for edge cases and error scenarios:

- Non-existent resource handling
- Concurrent operation scenarios
- Boundary value testing
- Invalid data type handling
- Unicode and special character support
- Resource cleanup and error recovery
- System stability under load

## Usage

### Running All Notes Tests

```bash
npm test -- tests/v1/modules/notes
```

### Running Specific Test Suites

```bash
# CRUD operations only
npm test -- tests/v1/modules/notes/notes.crud.test.ts

# Search functionality only
npm test -- tests/v1/modules/notes/notes.search.test.ts

# Security tests only
npm test -- tests/v1/modules/notes/notes.security.test.ts
```

### Running with Coverage

```bash
npm run test:coverage -- tests/v1/modules/notes
```

## Test Data Setup

All test files use the shared helpers from `notes.helpers.ts` which provide:

- **Database cleanup** - Ensures clean state between tests
- **Test user creation** - Creates authenticated users for testing
- **Test note creation** - Creates notes with various configurations
- **Test project creation** - Creates projects for note association
- **JWT token generation** - Provides authentication tokens
- **Database disconnection** - Clean shutdown

## Authentication

Tests use JWT tokens generated by the helper functions. Each test suite creates its own authenticated user context to ensure isolation.

## Database State

- Tests use the configured test database
- Each test file performs cleanup before and after execution
- Shared helpers ensure consistent data setup across all tests
- Soft deletes are properly handled and tested

## Coverage Goals

These tests aim to provide comprehensive coverage of:

- ✅ All API endpoints and HTTP methods
- ✅ Authentication and authorization flows
- ✅ Input validation and error handling
- ✅ Database operations and data integrity
- ✅ Business logic and workflows
- ✅ Edge cases and error scenarios
- ✅ Security vulnerabilities and protections

## Maintenance

When adding new features to the Notes module:

1. Add corresponding tests to the appropriate test file
2. Update shared helpers if new setup utilities are needed
3. Ensure new tests follow the established patterns
4. Update this README if new test files are added

## Dependencies

- **Jest** - Testing framework
- **Supertest** - HTTP endpoint testing
- **Prisma** - Database operations and types
- **bcrypt** - Password hashing for test users
- **jsonwebtoken** - JWT token generation for authentication
